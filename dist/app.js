angular.module("beerTime",["firebase","ngRoute"]).config(function($routeProvider){$routeProvider.when("/",{templateUrl:"views/scoreboard.html",controller:"ScoreBoardCtrl"}).when("/scoreboard",{templateUrl:"views/scoreboard.html",controller:"ScoreBoardCtrl"}).when("/beer",{templateUrl:"views/beers.html",controller:"BeerCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}),angular.module("beerTime").controller("BeerCtrl",["$scope","LoginService","$location","$firebaseArray",function($scope,LoginService,$location,$firebaseArray){"use strict";function createNewUser(type){var user={beer:0,wine:0,total:1,timestamp:(new Date).getTime()};user[type]=user[type]+1;var provider=auth.provider;return user.userName=auth[provider].displayName,user.id=auth[provider].id,user.imageURL=auth[provider].profileImageURL,users.$add(user),user}function isInList(id){var returnValue=!1;return angular.forEach(users,function(key){key.id===id&&(returnValue=!0)}),returnValue}function addDrink(type,id){var now=(new Date).getTime();angular.forEach(users,function(key){if(key.id===id){var fiveMinutesLate=key.timestamp+3e5;if(-1===key.userName.toUpperCase().indexOf("ARVID")&&fiveMinutesLate>now)return swal("Oops...","Slow down the drinking, only Arvid can drink that fast!","error"),!1;key.total=key.total+1,key[type]=key[type]+1,key.timestamp=(new Date).getTime(),users.$save(key).then(function(){swal("Drink registrated")})}})}var ref=new Firebase("https://beertime.firebaseio.com/data"),users=$firebaseArray(ref),auth=ref.getAuth();auth||$location.path("/login"),$scope.addBeer=function(type){if(auth){var provider=auth.provider,userId=auth[provider].id;if(isInList(userId))addDrink(type,userId);else{var user=createNewUser(type);addDrink(type,user.id)}}}}]),angular.module("beerTime").controller("LoginCtrl",["$scope","LoginService","$location",function($scope,LoginService,$location){var ref=new Firebase("https://beertime.firebaseio.com/data");ref.getAuth()&&$location.path("scoreboard"),$scope.logIn=function(provider){LoginService.logInPrompt(ref,provider)}}]),angular.module("beerTime").factory("LoginService",["$location",function($location){return{logInPrompt:function(ref,provider){return ref.authWithOAuthPopup(provider,function(error,authData){error?(alert("innan allt skit"),error.indexOf("TRANSPORT_UNAVAILABLE")>-1&&(alert(error),this.logInRedirect(ref,provider)),alert(error),console.log("Login Failed!",error)):$location.path("beer")})},logInRedirect:function(ref,provider){ref.authWithOAuthRedirect(provider,function(error,authData){error?(alert(error),console.log("Login Failed!",error)):$location.path("beer")})}}}]),angular.module("beerTime").controller("ScoreBoardCtrl",["$scope","$firebaseArray","$location",function($scope,$firebaseArray,$location){var ref=new Firebase("https://beertime.firebaseio.com/data");$scope.users=$firebaseArray(ref)}]);